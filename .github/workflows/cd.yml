name: CD - Deploy para Render

on:
  workflow_run:
    workflows: ["CI - Build e Testes"]
    types: 
      - completed

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v4

      - name: Informar início do deploy
        run: echo "CI passou — iniciando deploy para Render..."

      - name: Trigger Deploy no Render via Deploy Hook
        env:
          RENDER_HOOK: ${{ secrets.RENDER_DEPLOY_HOOK }}
        run: |
          if [ -z "$RENDER_HOOK" ]; then
            echo "ERRO: RENDER_DEPLOY_HOOK não foi configurado. Abortando."
            exit 1
          fi
          echo "Acionando o webhook de deploy do Render..."
          curl -X POST "$RENDER_HOOK" -sS --fail || (echo "Falha ao chamar webhook do Render" && exit 2)

      - name: Confirmar deploy
        run: echo "Deploy acionado. Verifique o painel do Render para status da build."
